<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIT ìì„¸ ë¶„ì„ AI (ìµœì¢… í†µí•©ë²„ì „)</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0b0f14;
  --panel: rgba(30, 34, 42, 0.7);
  --accent: #7c9cff;
  --accent2: #ffb86c;
  --ink: #e7eef7;
  --muted: #9bb0c7;
  --radius: 18px;
}
* { box-sizing: border-box; }
body {
  margin: 0; background: var(--bg); color: var(--ink);
  font-family: "Noto Sans KR", sans-serif;
  display: grid; grid-template-columns: 340px 1fr;
  height: 100vh; gap: 16px; padding: 16px;
}
.panel {
  background: var(--panel);
  backdrop-filter: blur(20px);
  border-radius: var(--radius);
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}
.sidebar { padding: 16px; overflow:auto; }
.title { font-size: 18px; font-weight:800; margin-bottom: 6px; }
.muted { color: var(--muted); }
.btn {
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 10px;
  padding: 8px 12px;
  background: rgba(255,255,255,0.05);
  color: var(--ink);
  cursor: pointer;
}
.btn:hover { background: rgba(255,255,255,0.12); }
.seg { display: flex; border-radius: 10px; overflow: hidden; margin-top: 8px; }
.seg button { flex:1; border:0; background: rgba(255,255,255,0.04); color:var(--muted); padding:8px; cursor:pointer; }
.seg button.active { background: rgba(124,156,255,0.25); color:var(--ink); }
label.btn input { display:none; }
.tbl { width:100%; border-collapse:collapse; font-size:13px; }
.tbl th,.tbl td { border-bottom:1px solid rgba(255,255,255,0.1); padding:6px 8px; }
.canvasWrap { display:flex; align-items:center; justify-content:center; }
canvas { max-width:100%; max-height:100%; border-radius:var(--radius); background:#0a0e13; }
@media(max-width:920px){
  body { grid-template-columns:1fr; height:auto; min-height:100vh; }
}
</style>
</head>
<body>
<aside class="panel sidebar">
  <div class="title">ğŸ“¸ DIT ìì„¸ ë¶„ì„ AI</div>
  <div class="muted">íŒŒì¼ ì—…ë¡œë“œ í›„ ì ì„ ì¡°ì •í•˜ê³  PDFë¡œ ì €ì¥í•˜ì„¸ìš”.</div>

  <div class="seg">
    <button id="btnBefore" class="active">Before</button>
    <button id="btnAfter">After</button>
  </div>
  <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
    <label class="btn">ğŸ“· íŒŒì¼ ì„ íƒ
      <input id="filePicker" type="file" accept="image/*">
    </label>
    <label class="btn">ğŸ“¸ ì§ì ‘ ì´¬ì˜
      <input id="cameraPicker" type="file" accept="image/*" capture="environment">
    </label>
    <button class="btn" id="btnReset">â†º ì´ˆê¸°í™”</button>
  </div>

  <div style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
    <button class="btn" id="btnSaveJSON">ğŸ’¾ ì¢Œí‘œ ì €ì¥</button>
    <button class="btn" id="btnLoadJSON">ğŸ“‚ ì¢Œí‘œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button class="btn" id="btnPDF">ğŸ“„ PDF ì €ì¥</button>
  </div>

  <div style="margin-top:12px;">
    <table class="tbl">
      <thead><tr><th>í•­ëª©</th><th>Before</th><th>After</th><th>ë³€í™”</th><th>ì •ìƒ</th></tr></thead>
      <tbody>
        <tr><td>CVA</td><td id="cmpCvaB">â€”</td><td id="cmpCvaA">â€”</td><td id="cmpCvaD">â€”</td><td>â‰¥50Â°</td></tr>
        <tr><td>TRUNK</td><td id="cmpPelB">â€”</td><td id="cmpPelA">â€”</td><td id="cmpPelD">â€”</td><td>|0â€“5Â°|</td></tr>
        <tr><td>KNEE</td><td id="cmpKneeB">â€”</td><td id="cmpKneeA">â€”</td><td id="cmpKneeD">â€”</td><td>175â€“185Â°</td></tr>
      </tbody>
    </table>
  </div>
</aside>
<main class="panel canvasWrap">
  <canvas id="cv" width="1600" height="1000"></canvas>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const { jsPDF } = window.jspdf;
const cv = document.getElementById("cv");
const ctx = cv.getContext("2d");
let DPR = window.devicePixelRatio || 1;
const sessions={Before:{img:null},After:{img:null}};
let cur="Before";

document.getElementById("btnBefore").onclick=()=>switchSession("Before");
document.getElementById("btnAfter").onclick=()=>switchSession("After");
function switchSession(s){cur=s;document.getElementById("btnBefore").classList.toggle("active",s==="Before");document.getElementById("btnAfter").classList.toggle("active",s==="After");draw();}

function resizeCanvasFor(img){
  const maxW=cv.parentElement.clientWidth-24, maxH=cv.parentElement.clientHeight-24;
  const r=img?Math.min(maxW/img.naturalWidth,maxH/img.naturalHeight):1;
  const w=Math.round((img?img.naturalWidth:1200)*r),h=Math.round((img?img.naturalHeight:800)*r);
  cv.width=w*DPR;cv.height=h*DPR;cv.style.width=w+"px";cv.style.height=h+"px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
  if(img)ctx.drawImage(img,0,0,w,h);
}
function draw(){
  ctx.fillStyle="#0a0e13";ctx.fillRect(0,0,cv.width,cv.height);
  const S=sessions[cur];if(S.img){resizeCanvasFor(S.img);}
}

// ì—…ë¡œë“œ ì¦‰ì‹œ í‘œì‹œ
["filePicker","cameraPicker"].forEach(id=>{
  document.getElementById(id).addEventListener("change",e=>{
    const f=e.target.files[0];if(!f)return;
    const img=new Image();img.onload=()=>{sessions[cur].img=img;resizeCanvasFor(img);draw();};
    img.crossOrigin="anonymous";img.src=URL.createObjectURL(f);
  });
});

// Reset ë²„íŠ¼
document.getElementById("btnReset").onclick=()=>{sessions[cur].img=null;draw();};

// PDF ì „ì²´í™”ë©´ ìº¡ì²˜
document.getElementById("btnPDF").onclick=async()=>{
  const target=document.body;
  const canvas=await html2canvas(target,{scale:2,backgroundColor:"#fff",useCORS:true});
  const imgData=canvas.toDataURL("image/png");
  const pdf=new jsPDF({orientation:"portrait",unit:"px",format:"a4"});
  const pageW=pdf.internal.pageSize.getWidth();
  const pageH=pdf.internal.pageSize.getHeight();
  const imgW=pageW-40, imgH=canvas.height*(imgW/canvas.width);
  let y=20;
  if(imgH<pageH-40){pdf.addImage(imgData,"PNG",20,y,imgW,imgH);}
  else{
    let remaining=imgH, sY=0;
    const onePageH=pageH-40, sliceH=canvas.height*(onePageH/imgH);
    while(remaining>0){
      const pageCanvas=document.createElement("canvas");
      pageCanvas.width=canvas.width;pageCanvas.height=Math.min(sliceH,canvas.height-sY);
      const pctx=pageCanvas.getContext("2d");
      pctx.drawImage(canvas,0,sY,canvas.width,pageCanvas.height,0,0,canvas.width,pageCanvas.height);
      const pageImg=pageCanvas.toDataURL("image/png");
      pdf.addImage(pageImg,"PNG",20,20,imgW,onePageH*(pageCanvas.height/sliceH));
      remaining-=onePageH;sY+=sliceH;if(remaining>0)pdf.addPage();
    }
  }
  pdf.save("DIT_ìì„¸_ë¶„ì„_ë¦¬í¬íŠ¸.pdf");
};
</script>
</body>
</html>
