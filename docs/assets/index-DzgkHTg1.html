<!DOCTYPE html>
<html lang="ko">
  <head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIT ìì„¸ ë¶„ì„ AI (ìµœì¢… í†µí•©ë²„ì „)</title>
<!-- Import-map (ë¸Œë¼ìš°ì €ê°€ importmapì„ ì§€ì›í•˜ë©´ @mediapipe/poseë¥¼ ë§¤í•‘) - ëª¨ë“  module scriptë³´ë‹¤ ë¨¼ì € ì™€ì•¼ í•¨ -->
<script type="importmap">
{
  "imports": {
    "@mediapipe/pose": "https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.164/pose.js"
  }
}
</script>
<!-- âœ… @mediapipe/pose ë¨¼ì € ë¡œë“œ (pose-detection ì˜ì¡´ì„± í•´ê²°) -->
<script type="module">
  // @mediapipe/poseë¥¼ ì „ì—­ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ë¨¼ì € ë¡œë“œ
  (async function() {
    if (window.MP_Pose) {
      console.log('âœ… @mediapipe/pose already loaded');
      return;
    }
    try {
      const mpModule = await import('https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.164/pose.js');
      window.MP_Pose = mpModule.default || mpModule.Pose || mpModule;
      // ì „ì—­ ë³€ìˆ˜ë¡œë„ ë…¸ì¶œ (pose-detection ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸í™˜ì„±)
      if (typeof window !== 'undefined' && !window.Pose) {
        window.Pose = window.MP_Pose;
      }
      console.log('âœ… @mediapipe/pose preloaded globally');
    } catch (err) {
      console.warn('âš ï¸ @mediapipe/pose preload failed (will retry later):', err);
    }
  })();
</script>

<!-- âœ… TensorFlow.js ì‹±ê¸€í†¤ ë¡œë” (ì¤‘ë³µ ë¡œë”© ì™„ì „ ì°¨ë‹¨) -->
<script>
  // Load TF.js exactly once and export a singleton on window.tfSingleton
  // Protects against duplicate kernel registration caused by multiple loads.
  (function(){
    if (window.tfSingleton && window.tfSingleton._loaded) {
      console.log('âœ… TF singleton already loaded');
      return;
    }
    window.tfSingleton = window.tfSingleton || { _loading: true, _loaded: false };
    async function loadTfOnce() {
      if (window.tfSingleton._loaded) return window.tfSingleton.tf;
      if (window.tfSingleton._loading && window.tfSingleton._promise) return window.tfSingleton._promise;
      window.tfSingleton._promise = (async () => {
        // âœ… UMD ë°©ì‹ ìš°ì„  ì‚¬ìš© (ì•ˆì •ì„± í™•ë³´)
        return new Promise((resolve, reject) => {
          // ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ë°”ë¡œ ë°˜í™˜
          if (window.tf) {
            window.tfSingleton.tf = window.tf;
            window.tfSingleton._loaded = true;
            window.tfSingleton._loading = false;
            console.log('âœ… TensorFlow.js already loaded (singleton)');
            resolve(window.tfSingleton.tf);
            return;
          }
          
          const s = document.createElement('script');
          // âœ… ì•ˆì •ì ì¸ CDN ê²½ë¡œ ì‚¬ìš© (UMD ë²„ì „)
          s.src = 'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js';
          s.onload = () => {
            window.tfSingleton.tf = window.tf || (window).tf;
            if (!window.tfSingleton.tf) {
              reject(new Error('TensorFlow.js loaded but window.tf is undefined'));
              return;
            }
            window.tfSingleton._loaded = true;
            window.tfSingleton._loading = false;
            console.log('âœ… TensorFlow.js loaded via UMD (singleton)');
            resolve(window.tfSingleton.tf);
          };
          s.onerror = (e) => {
            console.error('âŒ TensorFlow.js UMD load failed, trying ESM fallback', e);
            // ESM í´ë°± ì‹œë„
            import('https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/+esm')
              .then(mod => {
                const tf = (mod && (mod.default || mod.tf)) || mod;
                window.tfSingleton.tf = tf;
                window.tf = tf; // í˜¸í™˜ì„±
                window.tfSingleton._loaded = true;
                window.tfSingleton._loading = false;
                console.log('âœ… TensorFlow.js loaded via ESM fallback (singleton)');
                resolve(tf);
              })
              .catch(esmErr => {
                console.error('âŒ TensorFlow.js ESM fallback also failed', esmErr);
                reject(esmErr);
              });
          };
          document.head.appendChild(s);
        });
      })();
      return window.tfSingleton._promise;
    }
    // expose loader globally
    window.loadTfOnce = loadTfOnce;
  })();
</script>
<!-- âœ… 3. favicon.ico 404 ì˜¤ë¥˜ í•´ê²° (ì„ íƒì‚¬í•­) -->
<link rel="icon" type="image/png" href="/posture-ai-kor/pwa-192x192.png">
<style>
:root {
  --bg: #0b0f14;
  --panel: rgba(30, 34, 42, 0.7);
  --accent: #7c9cff;
  --accent2: #ffb86c;
  --ink: #e7eef7;
  --muted: #9bb0c7;
  --radius: 18px;
  --font-body: 'Apple SD Gothic Neo', 'Malgun Gothic', 'Nanum Gothic', 'Noto Sans KR', 'Pretendard', 'Segoe UI', 'Roboto', sans-serif;
}

/* PDFìš© ì•ˆì „ í°íŠ¸ (êµ¬ê¸€ í°íŠ¸ ì œì™¸) */
.pdf-safe {
  font-family: var(--font-body), sans-serif !important;
  letter-spacing: 0.2px;
  line-height: 1.45;
}

.pdf-safe * {
  font-family: inherit !important;
}
* { box-sizing: border-box; }
html, body {
  margin: 0; 
  padding: 0;
  height: 100%;
  -webkit-overflow-scrolling: touch;
}
body {
  background: var(--bg); 
  color: var(--ink);
  font-family: var(--font-body);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  overflow-x: hidden;
}
button, input, select, textarea {
  font-family: var(--font-body);
}
.panel {
  background: var(--panel);
  backdrop-filter: blur(20px);
  border-radius: var(--radius);
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}
.sidebar { 
  padding: 12px; 
  overflow-y: auto;
  overflow-x: hidden;
  max-height: 50vh;
  -webkit-overflow-scrolling: touch;
}
.title { 
  font-size: 16px; 
  font-weight:800; 
  margin-bottom: 6px; 
  line-height: 1.3;
}
.muted { 
  color: var(--muted); 
  font-size: 11px; 
  line-height: 1.4;
}
.btn {
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 10px;
  padding: 10px 14px;
  background: rgba(255,255,255,0.05);
  color: var(--ink);
  cursor: pointer;
  font-size: 13px;
  width: 100%;
  text-align: center;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}
.btn:hover, .btn:active { 
  background: rgba(255,255,255,0.12); 
}
.seg { 
  display: flex; 
  border-radius: 10px; 
  overflow: hidden; 
  margin-top: 8px; 
  gap: 4px;
}
.seg button { 
  flex:1; 
  border:0; 
  background: rgba(255,255,255,0.04); 
  color:var(--muted); 
  padding:10px 8px; 
  cursor:pointer; 
  font-size: 13px;
  touch-action: manipulation;
}
.seg button.active { 
  background: rgba(124,156,255,0.25); 
  color:var(--ink); 
}
label.btn { 
  display: block;
  width: 100%;
  margin-bottom: 8px;
  position: relative;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}
label.btn input { 
  position: absolute;
  opacity: 0;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  cursor: pointer;
  z-index: 10;
  pointer-events: auto;
  -webkit-tap-highlight-color: transparent;
  font-size: 0;
  margin: 0;
  padding: 0;
  border: 0;
}
.tbl { 
  width:100%; 
  border-collapse:collapse; 
  font-size:11px; 
  overflow-x: auto;
  display: table;
  -webkit-overflow-scrolling: touch;
}
.tbl th,.tbl td { 
  border-bottom:1px solid rgba(255,255,255,0.1); 
  padding:6px 4px; 
  text-align: center;
  font-size: 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.canvasWrap { 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  flex: 1;
  min-height: 50vh;
  padding: 8px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  position: relative;
}
.canvasWrap.zoomed {
  align-items: flex-start;
  justify-content: flex-start;
}
canvas { 
  border-radius:var(--radius); 
  background:#0a0e13; 
  cursor: crosshair; 
  touch-action: none; /* ë“œë˜ê·¸ì™€ ìŠ¤í¬ë¡¤ì„ JavaScriptë¡œ ì œì–´ */
  display: block;
  flex-shrink: 0;
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;
  user-select: none;
  -webkit-user-select: none;
}
</style>
  </head>
  <body>
<aside class="panel sidebar" style="order: 1;">
  <div class="title">ğŸ“¸ DIT ìì„¸ ë¶„ì„ AI</div>
  <div class="muted">íŒŒì¼ ì—…ë¡œë“œ â†’ ì ì„ ë“œë˜ê·¸ë¡œ ì¡°ì • â†’ ê°ë„ ìë™ ê³„ì‚°</div>

  <div class="seg">
    <button id="btnBefore" class="active">Before</button>
    <button id="btnAfter">After</button>
  </div>
  <div style="margin-top:8px; display:flex; flex-direction:column; gap:8px;">
    <div class="seg" style="margin-bottom:4px;">
      <button id="btnOrientationSide" class="active">ğŸ“ ì˜†ëª¨ìŠµ</button>
      <button id="btnOrientationFront">ğŸ“· ì •ë©´</button>
    </div>
    <label class="btn" for="filePicker">ğŸ“· íŒŒì¼ ì„ íƒ
      <input id="filePicker" name="filePicker" type="file" accept="image/*">
    </label>
    <label class="btn" for="cameraPicker">ğŸ“¸ ì§ì ‘ ì´¬ì˜
      <input id="cameraPicker" name="cameraPicker" type="file" accept="image/*" capture="environment">
    </label>
    <button class="btn" id="btnReset">â†º ì´ˆê¸°í™”</button>
    <button class="btn" id="btnCalibrate" style="background: rgba(255,184,108,0.2);">ğŸ“ ìº˜ë¦¬ë¸Œë ˆì´ì…˜</button>
  </div>

  <div id="calibrationPanel" style="margin-top:12px; padding:10px; background:rgba(255,184,108,0.1); border-radius:10px; display:none;">
    <div class="muted" style="margin-bottom:8px; font-weight:600;">ğŸ“ ìº˜ë¦¬ë¸Œë ˆì´ì…˜</div>
    <div class="muted" style="font-size:11px; margin-bottom:8px;">ê¸°ì¤€ ë§ˆì»¤ ë‘ ì ì„ ì°ê³  ì‹¤ì œ ê¸¸ì´(cm)ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
    <div style="margin-bottom:8px;">
      <input type="number" id="calibrationLength" name="calibrationLength" placeholder="ì‹¤ì œ ê¸¸ì´ (cm)" step="0.1" min="0.1" style="width:100%; padding:6px; border-radius:6px; border:1px solid rgba(255,255,255,0.2); background:rgba(0,0,0,0.3); color:var(--ink);">
    </div>
    <div class="muted" style="font-size:11px; margin-bottom:4px;">ì  1: <span id="calPoint1">í´ë¦­í•˜ì—¬ ì„ íƒ</span></div>
    <div class="muted" style="font-size:11px; margin-bottom:8px;">ì  2: <span id="calPoint2">í´ë¦­í•˜ì—¬ ì„ íƒ</span></div>
    <button class="btn" id="btnCalibrateConfirm" style="width:100%; margin-bottom:8px;">âœ… ê³„ì‚°</button>
    <button class="btn" id="btnCalibrateCancel" style="width:100%;">âŒ ì·¨ì†Œ</button>
    <div id="calibrationResult" class="muted" style="font-size:11px; margin-top:8px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.1);"></div>
  </div>

  <div style="margin-top:10px; display:flex; flex-direction:column; gap:8px;">
    <button class="btn" id="btnEditCoords" style="background: rgba(124,156,255,0.2);">âœï¸ ì¢Œí‘œ ìˆ˜ì • ëª¨ë“œ</button>
    <button class="btn" id="btnSaveJSON">ğŸ’¾ ì¢Œí‘œ ì €ì¥</button>
    <button class="btn" id="btnLoadJSON">ğŸ“‚ ì¢Œí‘œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button class="btn" id="btnPDF">ğŸ“„ PDF ì €ì¥</button>
    <button class="btn" id="btnImage">ğŸ–¼ï¸ ê·¸ë¦¼ìœ¼ë¡œ ì €ì¥</button>
    <button class="btn" id="btnShare">ğŸ“¤ ê³µìœ í•˜ê¸°</button>
    <button class="btn" id="btnAIAnalysis" style="background: rgba(46,196,182,0.3); border: 1px solid rgba(46,196,182,0.5);">ğŸ¤– AI ë¶„ì„</button>
  </div>

  <!-- ê³¨ë°˜ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
  <div id="pelvicDesc" style="white-space: pre-line; line-height:1.6; font-size:15px; margin-top:10px; padding:12px; background:rgba(124,156,255,0.1); border-radius:10px; display:none;"></div>

  <div id="coordEditPanel" style="margin-top:12px; padding:10px; background:rgba(124,156,255,0.1); border-radius:10px; display:none;">
    <div class="muted" style="margin-bottom:8px; font-weight:600;">ì¢Œí‘œ ìˆ˜ì •</div>
    <div style="margin-bottom:8px;">
      <div class="muted" style="font-size:11px; margin-bottom:4px;">í™•ëŒ€ ë°°ìœ¨</div>
      <select id="zoomLevel" class="btn" style="width:100%; padding:6px; margin-bottom:8px;">
        <option value="1">ì›ë³¸ í¬ê¸° (1ë°°)</option>
        <option value="2">2ë°° í™•ëŒ€ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥)</option>
        <option value="3">3ë°° í™•ëŒ€ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥)</option>
        <option value="4">4ë°° í™•ëŒ€ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥)</option>
      </select>
      <div class="muted" style="font-size:10px; margin-top:4px; margin-bottom:8px; line-height:1.4;">í™•ëŒ€ ì‹œ ì–‘ì†ìœ¼ë¡œ ë“œë˜ê·¸í•˜ì—¬ ì´ë™ ê°€ëŠ¥</div>
    </div>
    <div style="margin-bottom:8px;">
      <select id="coordSelectPoint" class="btn" style="width:100%; padding:6px; margin-bottom:6px;">
        <option value="">ì  ì„ íƒ...</option>
        <!-- ì˜µì…˜ì€ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨ -->
      </select>
    </div>
    <div style="display:flex; flex-direction:column; gap:6px; margin-bottom:6px;">
      <div>
        <div class="muted" style="font-size:11px; margin-bottom:4px;">X ì¢Œí‘œ</div>
        <div style="display:flex; gap:4px; align-items:center;">
          <input type="number" id="coordX" name="coordX" class="btn" style="flex:1; padding:8px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.1);" step="0.1" placeholder="X">
          <button class="btn" id="coordXDec" style="padding:8px 12px; background:rgba(255,107,107,0.2); border:1px solid rgba(255,107,107,0.3); min-width:40px;">âˆ’</button>
          <button class="btn" id="coordXInc" style="padding:8px 12px; background:rgba(46,196,182,0.2); border:1px solid rgba(46,196,182,0.3); min-width:40px;">+</button>
        </div>
      </div>
      <div>
        <div class="muted" style="font-size:11px; margin-bottom:4px;">Y ì¢Œí‘œ</div>
        <div style="display:flex; gap:4px; align-items:center;">
          <input type="number" id="coordY" name="coordY" class="btn" style="flex:1; padding:8px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.1);" step="0.1" placeholder="Y">
          <button class="btn" id="coordYDec" style="padding:8px 12px; background:rgba(255,107,107,0.2); border:1px solid rgba(255,107,107,0.3); min-width:40px;">âˆ’</button>
          <button class="btn" id="coordYInc" style="padding:8px 12px; background:rgba(46,196,182,0.2); border:1px solid rgba(46,196,182,0.3); min-width:40px;">+</button>
        </div>
      </div>
    </div>
    <button class="btn" id="coordApply" style="width:100%; background:rgba(124,156,255,0.3);">ì ìš©</button>
    <button class="btn" id="coordCancel" style="width:100%; margin-top:6px; background:rgba(255,255,255,0.05);">ì·¨ì†Œ</button>
  </div>

  <div style="margin-top:12px; padding:12px; background:rgba(124,156,255,0.1); border-radius:10px;">
    <div class="muted" style="margin-bottom:6px;">í˜„ì¬ ì„¸ì…˜: <span id="currentSession">Before</span></div>
    
    <!-- ì£¼ìš” ì§€í‘œ (ê°„ëµ í‘œì‹œ) -->
    <div style="margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid rgba(255,255,255,0.1);">
      <div class="muted" style="margin-bottom:4px;">CVA: <span id="dispCva">â€”</span></div>
      <div class="muted" style="margin-bottom:4px;">TRUNK: <span id="dispPel">â€”</span></div>
      <div class="muted" style="margin-bottom:4px;">KNEE: <span id="dispKnee">â€”</span></div>
    </div>
    
    <!-- ì „ì²´ ë¶„ì„ í•­ëª© (16ê°€ì§€) -->
    <div id="allMetricsPanel" style="max-height:300px; overflow-y:auto; margin-bottom:8px;">
      <div style="font-size:12px; font-weight:600; margin-bottom:6px; color:#7c9cff;">ğŸ“Š ì „ì²´ ë¶„ì„ í•­ëª©</div>
      <div id="allMetricsList" style="font-size:11px; line-height:1.6;"></div>
    </div>
    
    <div style="margin-top:12px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.1);">
      <div style="font-size:14px; font-weight:600; margin-bottom:8px;">ğŸ“Š ì²´í˜• ì¢…í•© ì ìˆ˜</div>
      <div id="totalScore" style="font-size:32px; font-weight:800; margin-bottom:8px;">â€”</div>
      <div id="scoreReason" class="muted" style="font-size:11px; line-height:1.4; margin-bottom:8px;"></div>
      <div id="pdsScore" class="muted" style="font-size:12px; margin-top:6px;">PDS: <span id="pdsValue">â€”</span></div>
    </div>
  </div>


  <!-- AI PRO ë¦¬í¬íŠ¸ í‘œì‹œ ì˜ì—­ -->
  <div id="report-box" style="margin-top:12px; padding:12px; background:rgba(46,196,182,0.1); border-radius:10px; display:none; white-space: pre-wrap; font-size:12px; line-height:1.5; max-height:400px; overflow-y:auto; color:var(--ink); font-family: 'Noto Sans KR', sans-serif;"></div>
  
  <!-- 16ê°œ í•­ëª© ìƒì„¸ ì„¤ëª… -->
  <div id="metricsDescPanel" style="margin-top:12px; padding:12px; background:rgba(124,156,255,0.1); border-radius:10px;">
    <div style="font-size:14px; font-weight:600; margin-bottom:8px; color:#7c9cff;">ğŸ“‹ ë¶„ì„ í•­ëª© ì„¤ëª…</div>
    <div style="font-size:11px; color:#7c9cff; margin-bottom:8px; padding:4px 8px; background:rgba(124,156,255,0.2); border-radius:4px; display:inline-block;">ì¸¡ë©´ í•­ëª© (ì˜†ëª¨ìŠµ)</div>
    <div style="font-size:11px; color:#2ec4b6; margin-bottom:8px; padding:4px 8px; background:rgba(46,196,182,0.2); border-radius:4px; display:inline-block; margin-left:8px;">ì •ë©´ í•­ëª© (ì•ëª¨ìŠµ)</div>
    <div id="metricsDescContent" style="max-height:400px; overflow-y:auto; font-size:11px; line-height:1.6;">
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">CVA (Craniovertebral Angle)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ê·€ ë’¤ ìœ ì–‘ëŒê¸°(Tragus)ì™€ ì œ7ê²½ì¶”(C7) ì‚¬ì´ì˜ ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ê±°ë¶ëª© ìì„¸ì˜ ì •ë„ë¥¼ í‰ê°€í•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ì§€í‘œì…ë‹ˆë‹¤. ê°ë„ê°€ ì‘ì„ìˆ˜ë¡ ë¨¸ë¦¬ê°€ ì•ìœ¼ë¡œ ë‚˜ì˜¨ ìƒíƒœì…ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¥50Â° (ê°ë„ê°€ í´ìˆ˜ë¡ ì¢‹ìŒ)<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> CVA &lt; 50Â°ëŠ” ì „ë°©ë‘ë¶€ìì„¸(FHP)ë¥¼ ì˜ë¯¸í•˜ë©°, ê²½ì¶” ê·¼ìœ¡ ê¸´ì¥, ë‘í†µ, ëª© í†µì¦ì˜ ì›ì¸ì´ ë©ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">HPD (Head Protrusion Distance)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ê·€(Tragus)ì™€ ì–´ê¹¨(Acromion) ì‚¬ì´ì˜ ìˆ˜í‰ ê±°ë¦¬<br>
          <strong>ì˜ë¯¸:</strong> ë¨¸ë¦¬ê°€ ëª¸í†µì—ì„œ ì–¼ë§ˆë‚˜ ì•ìœ¼ë¡œ ëŒì¶œë˜ì–´ ìˆëŠ”ì§€ë¥¼ cm ë‹¨ìœ„ë¡œ ì¸¡ì •í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¤2cm<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> 2cm ì´ˆê³¼ ì‹œ ê²½ì¶” ë¶€ë‹´ ì¦ê°€, ìƒë¶€ ìŠ¹ëª¨ê·¼ ê³¼ê¸´ì¥, ëª©-ì–´ê¹¨ í†µì¦ ìœ ë°œ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">TIA (Trunk Inclination Angle)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ì–´ê¹¨(Acromion)ì™€ ê³¨ë°˜(Hip)ì„ ì—°ê²°í•œ ì„ ê³¼ ìˆ˜ì§ì„  ì‚¬ì´ì˜ ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ëª¸í†µì˜ ì•ë’¤ ê¸°ìš¸ê¸°ë¥¼ í‰ê°€í•˜ì—¬ ì „ì²´ì ì¸ ì²´ê°„ ì •ë ¬ì„ í™•ì¸í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0-10Â°<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> 10Â° ì´ˆê³¼ ì‹œ ìš”ì¶” ê³¼ì „ë§Œ ë˜ëŠ” í‰í‰í•œ ë“±(Flat Back) ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">SAA (Scapular Alignment Angle)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ì–´ê¹¨(Acromion)ì™€ ê³¨ë°˜ í›„ë©´(PSIS)ì„ ì—°ê²°í•œ ì„ ê³¼ ìˆ˜í‰ì„  ì‚¬ì´ì˜ ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ì–´ê¹¨ë¼ˆì˜ ì •ë ¬ ìƒíƒœì™€ ìƒë¶€ ì²´ê°„ì˜ ìì„¸ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0-10Â°<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> ì´ìƒ ì‹œ ê²¬ê°‘ê³¨ ë‚ ê°œë¼ˆ(Winging) ë˜ëŠ” ì–´ê¹¨ ì „ë°© ë§ë¦¼ì´ ì˜ì‹¬ë©ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">PTA (Pelvic Tilt Angle)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> í›„ìƒì¥ê³¨ê·¹(PSIS)ê³¼ ì „ìƒì¥ê³¨ê·¹(ASIS)ì„ ì—°ê²°í•œ ì„ ê³¼ ìˆ˜í‰ì„  ì‚¬ì´ì˜ ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ê³¨ë°˜ì˜ ì „ë°© ë˜ëŠ” í›„ë°© ê¸°ìš¸ê¸°ë¥¼ í‰ê°€í•˜ëŠ” í•µì‹¬ ì§€í‘œì…ë‹ˆë‹¤.<br>
          <strong>í•´ì„ ê¸°ì¤€:</strong> PSIS ê¸°ì¤€ìœ¼ë¡œ ASISì™€ ê°™ì€ ë†’ì´ = 0ë„, ASISê°€ PSISë³´ë‹¤ ìœ„ìª½ì— ìˆìœ¼ë©´ = ê³¨ë°˜ í›„ë°©ê²½ì‚¬(ìŒìˆ˜, -1ë„ë¶€í„°), ASISê°€ PSISë³´ë‹¤ ë°‘ìª½ì— ìˆìœ¼ë©´ = ê³¨ë°˜ ì „ë°©ê²½ì‚¬(ì–‘ìˆ˜, 1ë„ë¶€í„°)<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0-15Â° (ì•½ê°„ì˜ ì „ë°© ê²½ì‚¬ëŠ” ì •ìƒ)<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> &gt;15Â° (ì–‘ìˆ˜)ëŠ” ê³¨ë°˜ ì „ë°© ê²½ì‚¬(ìš”ì¶” ê³¼ì „ë§Œ), &lt;0Â° (ìŒìˆ˜)ëŠ” ê³¨ë°˜ í›„ë°© ê²½ì‚¬(ìš”ì¶” í‰í‰)ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">KA (Knee Alignment Angle)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ê³ ê´€ì ˆ(Hip)-ë¬´ë¦(Knee)-ë°œëª©(Ankle) ì„¸ ì ì´ ì´ë£¨ëŠ” ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ë¬´ë¦ ê´€ì ˆì˜ ì‹ ì „(í´ì§) ì •ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 175-185Â°<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> &lt;175Â°ëŠ” ë¬´ë¦ ê³¼êµ´ê³¡(ìŠ¬ê°œê±´ ë¶€ë‹´), &gt;185Â°ëŠ” ë¬´ë¦ ê³¼ì‹ ì „(ê´€ì ˆ ë¶ˆì•ˆì •ì„±)ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">Tibial Angle (ê²½ê³¨ ê²½ì‚¬ê°)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ë¬´ë¦(Knee)ê³¼ ë°œëª©(Ankle)ì„ ì—°ê²°í•œ ì„ ê³¼ ìˆ˜ì§ì„  ì‚¬ì´ì˜ ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ì •ê°•ì´(ê²½ê³¨)ì˜ ì•ë’¤ ê¸°ìš¸ê¸°ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0-10Â°<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> ê³¼ë„í•œ ê²½ì‚¬ëŠ” ë°œëª© ë¶ˆì•ˆì •ì„± ë° ì¢…ì•„ë¦¬ ê·¼ìœ¡ ë¶ˆê· í˜•ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">Q-Angle (ëŒ€í‡´ì‚¬ë‘ê·¼ ê°ë„)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ASIS-ìŠ¬ê°œê³¨(Patella)-ê²½ê³¨ì¡°ë©´(Tibial Tuberosity) ì„¸ ì ì´ ì´ë£¨ëŠ” ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ëŒ€í‡´ì‚¬ë‘ê·¼ì˜ ë‹¹ê¹€ ë°©í–¥ì„ í‰ê°€í•˜ì—¬ ë¬´ë¦ ì •ë ¬ì„ í™•ì¸í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> ë‚¨ì„± 10-15Â°, ì—¬ì„± 15-20Â°<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> &gt;20Â°ëŠ” ìŠ¬ê°œê³¨ ì™¸ì¸¡ ì „ìœ„ ë° ìŠ¬ê°œëŒ€í‡´ í†µì¦ ì¦í›„êµ°ì˜ ìœ„í—˜ ìš”ì¸ì…ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">Knee Deviation (ë¬´ë¦ ë†’ì´ ì°¨)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ì¢Œìš° ë¬´ë¦ì˜ ë†’ì´ ì°¨ì´ë¥¼ ê°ë„ë¡œ í™˜ì‚°<br>
          <strong>ì˜ë¯¸:</strong> ì–‘ìª½ ë¬´ë¦ì˜ ìˆ˜í‰ ì •ë ¬ì„ í‰ê°€í•˜ì—¬ ê³¨ë°˜ ê¸°ìš¸ê¸°ë¥¼ ê°„ì ‘ì ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0-3Â°<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> 3Â° ì´ˆê³¼ ì‹œ ê³¨ë°˜ íšŒì „(Pelvic Rotation) ë˜ëŠ” ì²™ì¶” ì¸¡ë§Œì¦ì´ ì˜ì‹¬ë©ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">LLD (Leg Length Discrepancy)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ì¢Œìš° ë‹¤ë¦¬ ê¸¸ì´(Hip-Ankle) ì°¨ì´ë¥¼ cm ë‹¨ìœ„ë¡œ ì¸¡ì •<br>
          <strong>ì˜ë¯¸:</strong> ê¸°ëŠ¥ì  ë˜ëŠ” êµ¬ì¡°ì  ë‹¤ë¦¬ ê¸¸ì´ ì°¨ì´ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¤1cm<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> 1cm ì´ˆê³¼ ì‹œ ê³¨ë°˜ ë¹„ëŒ€ì¹­, ì²™ì¶” ì¸¡ë§Œ, ë³´í–‰ ì´ìƒì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë©° ë³´ìƒ ìì„¸ë¡œ ì¸í•œ ë§Œì„± í†µì¦ì˜ ì›ì¸ì´ ë©ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">GSB (Global Sagittal Balance)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ê·€(Tragus)ì™€ ë°œëª©(Ankle)ì˜ ìˆ˜í‰ ê±°ë¦¬<br>
          <strong>ì˜ë¯¸:</strong> ì „ì‹ ì˜ ì‹œìƒë©´(ì˜†ì—ì„œ ë³¸) ê· í˜•ì„ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ì§€í‘œì…ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¤2cm<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> 2cm ì´ˆê³¼ ì‹œ ì¤‘ë ¥ ì¤‘ì‹¬ì„  ì´íƒˆë¡œ ì¸í•œ ì „ì²´ ê·¼ê³¨ê²©ê³„ ë¶€ë‹´ ì¦ê°€ ë° ì—ë„ˆì§€ ì†Œëª¨ê°€ ì¦ê°€í•©ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">HPA (Headâ€“Pelvis Angle)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ë¨¸ë¦¬(Tragus)ì™€ ê³¨ë°˜(PSIS)ì„ ì—°ê²°í•œ ì„ ê³¼ ìˆ˜ì§ì„  ì‚¬ì´ì˜ ê°ë„<br>
          <strong>ì˜ë¯¸:</strong> ë¨¸ë¦¬ì™€ ê³¨ë°˜ì˜ ìƒëŒ€ì  ìœ„ì¹˜ ê´€ê³„ë¥¼ í†µí•´ ì „ì‹  ìì„¸ë¥¼ ì¢…í•© í‰ê°€í•©ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0-10Â°<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> ì´ìƒ ê°ë„ëŠ” ë¨¸ë¦¬-ê³¨ë°˜ ë¶„ì ˆ ê°„ í˜‘ì‘ ë¶€ì¡±ì„ ë‚˜íƒ€ë‚´ë©°, ì „ì‹  ìì„¸ ë¶ˆê· í˜•ì˜ ì§€í‘œì…ë‹ˆë‹¤.
        </div>
      </details>
      <details style="margin-bottom:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#7c9cff; padding:4px 0;">PDS (Postural Deviation Score)</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ë°©ë²•:</strong> ìœ„ 15ê°œ í•­ëª©ì˜ ë¹„ì •ìƒ ì •ë„ë¥¼ ì ìˆ˜í™”í•˜ì—¬ í•©ì‚°<br>
          <strong>ì˜ë¯¸:</strong> ì „ì²´ì ì¸ ìì„¸ ë¶ˆê· í˜•ì˜ ì •ë„ë¥¼ í•˜ë‚˜ì˜ ìˆ«ìë¡œ ìš”ì•½í•œ ì¢…í•© ì§€í‘œì…ë‹ˆë‹¤.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0-10ì <br>
          <strong>ë¶„ë¥˜:</strong> 0-10 (ì •ìƒ), 11-20 (ê²½ë¯¸), 21-30 (ì¤‘ë“±ë„), 31+ (ì‹¬ê°)<br>
          <strong>ì„ìƒì  ì˜ë¯¸:</strong> ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ë‹¤ì–‘í•œ ìì„¸ ë¬¸ì œê°€ ë³µí•©ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ë©°, ì „ë¬¸ì ì¸ êµì • ì¹˜ë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤.
        </div>
      </details>
      
      <!-- ì •ë©´ í•­ëª© (ì•ëª¨ìŠµ) - ìƒ‰ìƒ: #2ec4b6 -->
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">STA (Shoulder Tilt Angle) - ì–´ê¹¨ ì¢Œìš° ê¸°ìš¸ê¸°</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> angle(line(L_acromion, R_acromion), horizontal)<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì¹´ë©”ë¼ë¥¼ ê°€ìŠ´ ì¤‘ì•™ ë†’ì´ì— ê³ ì •í•˜ê³  í”¼í—˜ìëŠ” ì •ë©´ìœ¼ë¡œ ì„  ìì„¸ ìœ ì§€. â‘¡ ì¢ŒÂ·ìš° Acromionì˜ ì¢Œí‘œë¥¼ ì¸ì‹. â‘¢ Î”yë¥¼ ê°ë„ë¡œ ë³€í™˜(atan(Î”y / Î”x)).<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¤ 3Â°<br>
          <strong>í•´ì„:</strong> â†‘ â†’ ì–´ê¹¨ ì¢Œìš° ë¶ˆê· í˜•, ìŠ¹ëª¨ê·¼Â·ëŠ¥í˜•ê·¼ ê¸´ì¥ ì°¨ì´ ê°€ëŠ¥ì„±.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">POA (Pelvic Obliquity Angle) - ê³¨ë°˜ ì¢Œìš° ê¸°ìš¸ê¸°</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> angle(line(L_ASIS, R_ASIS), horizontal)<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì¹´ë©”ë¼ë¥¼ ê³¨ë°˜ ë†’ì´ì— ë§ì¶”ê³  ì •ë©´ì—ì„œ ì´¬ì˜. â‘¡ ì¢ŒÂ·ìš° ASISë¥¼ ì¸ì‹í•˜ê³  Î”y ê³„ì‚°. â‘¢ ê°ë„ ê³„ì‚°: POA = atan(Î”y / Î”x).<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¤ 3Â°<br>
          <strong>í•´ì„:</strong> â†‘ â†’ ê³¨ë°˜ ì¢Œìš° ë¹„ëŒ€ì¹­ / í•˜ì§€ ê¸¸ì´ ì°¨ / ìš”ì¶” ì¸¡ë§Œ ê°€ëŠ¥ì„±.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">LLD (Leg Length Discrepancy) - í•˜ì§€ ê¸¸ì´ ì°¨</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> |distance(L_ASIS, L_ankle) - distance(R_ASIS, R_ankle)|<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì „ì‹ ì´ ë³´ì´ë„ë¡ ì •ë©´ ì´¬ì˜. â‘¡ ì¢ŒÂ·ìš° ASIS ë° ë°œëª©(Ankle) ì¢Œí‘œ ì¸ì‹. â‘¢ ê±°ë¦¬(cm) í™˜ì‚°(pxPerCm ë³´ì •).<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¤ 1 cm<br>
          <strong>í•´ì„:</strong> â†‘ â†’ êµ¬ì¡°ì  ë˜ëŠ” ê¸°ëŠ¥ì  í•˜ì§€ ê¸¸ì´ ì°¨ ì¡´ì¬.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">TD (Trunk Deviation) - ì²´ê°„ í¸ìœ„</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> horizontal deviation(C7, midline(L_ankle, R_ankle))<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì¹´ë©”ë¼ë¥¼ ì •ë©´, ì–‘ ë°œëª©ì´ ìˆ˜í‰ì— ì˜¤ë„ë¡ ì´¬ì˜. â‘¡ L/R Ankle ì¢Œí‘œë¡œ ì¤‘ê°„ì„ (midpoint) ê³„ì‚°. â‘¢ C7ì˜ ìˆ˜í‰ ê±°ë¦¬ í¸ì°¨ ê³„ì‚°.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> Â± 2Â°<br>
          <strong>í•´ì„:</strong> â†‘ â†’ ì²´ê°„ì´ ì¢Œìš°ë¡œ ê¸°ìš¸ì–´ì§ / ì²´ì¤‘ ì¤‘ì‹¬ ë¶ˆê· í˜•.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">HTA (Head Tilt Angle) - ë¨¸ë¦¬ ì¢Œìš° ê¸°ìš¸ê¸°</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> angle(line(L_tragus, R_tragus), horizontal)<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì •ë©´ì—ì„œ Tragus ì¢Œìš°ê°€ ëª…í™•íˆ ë³´ì´ë„ë¡ ì´¬ì˜. â‘¡ ë‘ ì ì˜ yì¢Œí‘œ ì°¨ì´ ê³„ì‚° â†’ ê°ë„ë¡œ ë³€í™˜.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> â‰¤ 3Â°<br>
          <strong>í•´ì„:</strong> â†‘ â†’ ê²½ë¶€ ì¸¡êµ´ ë˜ëŠ” ì¸¡ë§Œì„± ê¸´ì¥ íŒ¨í„´.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">SPP (Shoulderâ€“Pelvis Parallelism) - ì–´ê¹¨-ê³¨ë°˜ í‰í–‰ë„</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> angle_diff(line(L_acromion, R_acromion), line(L_ASIS, R_ASIS))<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì •ë©´ ì´¬ì˜ ì‹œ L/R ì–´ê¹¨ì™€ L/R ASISê°€ ëª¨ë‘ ë³´ì—¬ì•¼ í•¨. â‘¡ ë‘ ì„ ì˜ ê°ë„ ì°¨ ê³„ì‚°.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0â€“3Â°<br>
          <strong>í•´ì„:</strong> â†‘ â†’ ì²´ê°„ íšŒì „ / ê³¨ë°˜ ë¹„í‹€ë¦¼ / ì²™ì¶” íšŒì „ì„± ë¶ˆê· í˜•.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">KAS (Knee Alignment Symmetry) - ë¬´ë¦ ì •ë ¬ ëŒ€ì¹­ì„±</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> angle_diff(line(L_knee, L_ankle), line(R_knee, R_ankle))<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì •ë©´ì—ì„œ ë¬´ë¦ê³¼ ë°œëª© ëª¨ë‘ ì¸ì‹. â‘¡ ê° ë¬´ë¦â€“ë°œëª© ìˆ˜ì§ì„ ì˜ ê°ë„ ë¹„êµ.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> ëŒ€ì¹­(Â±2Â° ì´ë‚´)<br>
          <strong>í•´ì„:</strong> â†‘ â†’ í•œìª½ ë‚´ë°˜/ì™¸ë°˜ ë˜ëŠ” í•˜ì§€ íšŒì „ íŒ¨í„´.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">LLAS (Lower Limb Axis Symmetry) - í•˜ì§€ ì¶• ëŒ€ì¹­ì„±</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> angle_diff(line(L_ASIS, L_ankle), line(R_ASIS, R_ankle))<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  ì •ë©´ì—ì„œ í•˜ì§€ ì „ì²´ ì´¬ì˜. â‘¡ ê° í•˜ì§€ì¶• ë¼ì¸ ê°ë„ ë¹„êµ.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> Â±2Â°<br>
          <strong>í•´ì„:</strong> â†‘ â†’ í•œìª½ íšŒë‚´Â·íšŒì™¸ ë˜ëŠ” í•˜ì§€ íšŒì „ì„± ë¶ˆê· í˜•.
        </div>
      </details>
      
      <details style="margin-bottom:8px; border-left:3px solid #2ec4b6; padding-left:8px;">
        <summary style="cursor:pointer; font-weight:600; color:#2ec4b6; padding:4px 0;">FBA (Foot Base Angle) - ë°œ ì •ë ¬ ê°ë„</summary>
        <div style="padding:8px 0 0 12px; color:var(--muted); line-height:1.5;">
          <strong>ì¸¡ì • ê¸°ì¤€:</strong> angle(line(ankle, toe), body midline)<br>
          <strong>ì¸¡ì • ë°©ë²•:</strong> â‘  í”¼í—˜ìëŠ” ë°œëê¹Œì§€ ë³´ì´ê²Œ ì •ë©´ìœ¼ë¡œ ì„ ë‹¤. â‘¡ ë°œ ì¤‘ì‹¬ì„ (ankleâ€“toe)ê³¼ ëª¸ ì¤‘ì‹¬ì„  ê°„ ê°ë„ ê³„ì‚°.<br>
          <strong>ì •ìƒ ë²”ìœ„:</strong> 0â€“10Â°<br>
          <strong>í•´ì„:</strong> â†‘ â†’ ê³¼ë„í•œ ì™¸íšŒì „(íšŒì™¸) / â†“ â†’ íšŒë‚´ ê²½í–¥.
        </div>
      </details>
    </div>
  </div>
  
  <!-- ì‹¤ì‹œê°„ ë¶„ì„ ê²°ê³¼ íŒ¨ë„ -->
  <div id="liveAnalysisPanel" style="margin-top:12px; padding:12px; background:rgba(124,156,255,0.1); border-radius:10px; display:none;">
    <div style="font-size:14px; font-weight:600; margin-bottom:8px; color:#7c9cff;">ğŸ“Š ì‹¤ì‹œê°„ AI ë¶„ì„ ê²°ê³¼</div>
    <div id="livePDS" style="font-size:16px; font-weight:700; margin-bottom:8px; color:#7c9cff;">PDS: â€”</div>
    <div id="livePatterns" style="font-size:12px; line-height:1.6;"></div>
  </div>

  <!-- ê·¼ìœ¡ ìƒíƒœ ë¶„ì„ (ë¨¼ì € í‘œì‹œ) -->
  <div id="musclePanel" style="margin-top:12px; padding:12px; background:rgba(255,184,108,0.1); border-radius:10px; display:none;">
    <div style="font-size:14px; font-weight:600; margin-bottom:8px; color:#ffb86c; font-family: 'Noto Sans KR', sans-serif;">ğŸ’ª ê·¼ìœ¡ ìƒíƒœ ë¶„ì„</div>
    <div id="muscleTight" style="margin-bottom:8px;">
      <div class="muted" style="font-size:12px; margin-bottom:4px; font-family: 'Noto Sans KR', sans-serif;">ğŸ”´ ê¸´ì¥ëœ ê·¼ìœ¡:</div>
      <div id="muscleTightList" style="font-size:12px; color:#ff6b6b; line-height:1.6; font-family: 'Noto Sans KR', sans-serif;"></div>
    </div>
    <div id="muscleWeak" style="margin-bottom:8px;">
      <div class="muted" style="font-size:12px; margin-bottom:4px; font-family: 'Noto Sans KR', sans-serif;">ğŸ”µ ì•½í™”ëœ ê·¼ìœ¡:</div>
      <div id="muscleWeakList" style="font-size:12px; color:#7c9cff; line-height:1.6; font-family: 'Noto Sans KR', sans-serif;"></div>
    </div>
  </div>

  <!-- AI ì²´í˜• ë¶„ì„ (ê·¼ìœ¡ ìƒíƒœ ë¶„ì„ ë‹¤ìŒ) -->
  <div id="aiCommentPanel" style="margin-top:12px; padding:12px; background:rgba(46,196,182,0.1); border-radius:10px; display:none; font-family: 'Noto Sans KR', sans-serif;">
    <div style="font-size:14px; font-weight:600; margin-bottom:8px; color:#2ec4b6; font-family: 'Noto Sans KR', sans-serif;">ğŸ¤– AI ì²´í˜• ë¶„ì„</div>
    <div id="aiComment" class="muted" style="font-size:12px; line-height:1.6; font-family: 'Noto Sans KR', sans-serif; color:var(--ink);"></div>
    
    <!-- ê°œì¸ë³„ ì²´í˜• ë¶„ì„ ì„¤ëª… -->
    <div id="postureTypeDesc" style="margin-top:12px; padding:10px; background:rgba(255,255,255,0.1); border-radius:8px; border-left:3px solid #2ec4b6; font-family: 'Noto Sans KR', sans-serif;">
      <div style="font-size:13px; font-weight:600; margin-bottom:6px; color:#2ec4b6; font-family: 'Noto Sans KR', sans-serif;">ğŸ“Œ ì²´í˜• ìœ í˜• ë¶„ì„</div>
      <div id="postureTypeContent" style="font-size:12px; line-height:1.6; color:var(--muted); font-family: 'Noto Sans KR', sans-serif;"></div>
    </div>
  </div>

  <!-- ì¶”ì²œ ìš´ë™ -->
  <div id="exercisePanel" style="margin-top:12px; padding:12px; background:rgba(46,196,182,0.15); border-radius:10px; display:none;">
    <div style="font-size:14px; font-weight:600; margin-bottom:8px; color:#2ec4b6; font-family: 'Noto Sans KR', sans-serif;">ğŸ‹ï¸ ì¶”ì²œ ìš´ë™</div>
    <div id="exerciseList" style="font-size:12px; line-height:1.6; font-family: 'Noto Sans KR', sans-serif;"></div>
  </div>

  <!-- í•„ë¼í…ŒìŠ¤ ì„¸ì…˜ ì¶”ì²œ -->
  <div id="pilatesPanel" style="margin-top:12px; padding:12px; background:rgba(156,136,255,0.15); border-radius:10px; display:none;">
    <div style="font-size:14px; font-weight:600; margin-bottom:8px; color:#9c88ff; font-family: 'Noto Sans KR', sans-serif;">ğŸ§˜ í•„ë¼í…ŒìŠ¤ ì„¸ì…˜ ì¶”ì²œ</div>
    <div id="pilatesList" style="font-size:12px; line-height:1.6; font-family: 'Noto Sans KR', sans-serif;"></div>
  </div>

  <!-- í•„ë¼í…ŒìŠ¤ ìš´ë™ ìƒì„¸ ì„¤ëª… ëª¨ë‹¬ -->
  <div id="pilatesExerciseModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; overflow-y:auto; padding:20px; box-sizing:border-box;">
    <div style="max-width:600px; margin:0 auto; background:#1a1a2e; border-radius:12px; padding:20px; box-shadow:0 4px 20px rgba(0,0,0,0.5);">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 id="modalExerciseTitle" style="margin:0; color:#9c88ff; font-size:18px; font-weight:600;"></h3>
        <button id="closeModalBtn" style="background:none; border:none; color:#fff; font-size:24px; cursor:pointer; padding:0; width:30px; height:30px; display:flex; align-items:center; justify-content:center;">&times;</button>
      </div>
      <div id="modalExerciseContent" style="color:#e0e0e0; line-height:1.8; font-size:13px;">
        <!-- ìš´ë™ ìƒì„¸ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
      </div>
    </div>
  </div>


  <!-- ê²°ë¡  ë° í–¥í›„ ê¶Œì¥ì‚¬í•­ (íšŒì› ì´ë¦„ í¬í•¨, ì„ìƒ ì¤‘ì‹¬) -->
  <div id="conclusionPanel" style="margin-top:12px; padding:12px; background:rgba(46,196,182,0.1); border-radius:10px; display:none;">
    <div style="font-size:14px; font-weight:600; margin-bottom:8px; color:#2ec4b6; font-family: 'Noto Sans KR', sans-serif;">âœ… ê²°ë¡  ë° í–¥í›„ ê¶Œì¥ì‚¬í•­</div>
    <div id="conclusionContent" style="font-size:12px; line-height:1.8; color:var(--ink); font-family: 'Noto Sans KR', sans-serif; white-space:pre-wrap; word-wrap:break-word;"></div>
  </div>

  <!-- í•­ëª© (Before/After ë¹„êµ í…Œì´ë¸”) -->
  <div style="margin-top:12px; max-height:400px; overflow-y:auto;">
    <table class="tbl">
      <thead><tr><th>í•­ëª©</th><th>Before</th><th>After</th><th>ë³€í™”</th><th>ì •ìƒ</th></tr></thead>
      <tbody>
        <tr><td>CVA(ë‘ê°œê²½ì¶”ê°)</td><td id="cmpCvaB">â€”</td><td id="cmpCvaA">â€”</td><td id="cmpCvaD">â€”</td><td>â‰¥50Â°</td></tr>
        <tr><td>HPD(ë‘ë¶€ì „ë°©ì´ë™)</td><td id="cmpHpdB">â€”</td><td id="cmpHpdA">â€”</td><td id="cmpHpdD">â€”</td><td>â‰¤2cm</td></tr>
        <tr><td>TIA(ì²´ê°„ê²½ì‚¬ê°)</td><td id="cmpTiaB">â€”</td><td id="cmpTiaA">â€”</td><td id="cmpTiaD">â€”</td><td>0-10Â°</td></tr>
        <tr><td>SAA(ì–´ê¹¨ì „ë°©ê°)</td><td id="cmpSaaB">â€”</td><td id="cmpSaaA">â€”</td><td id="cmpSaaD">â€”</td><td>0-10Â°</td></tr>
        <tr><td>PTA(ê³¨ë°˜ ì „í›„ê²½ì‚¬ê°)</td><td id="cmpPtaB">â€”</td><td id="cmpPtaA">â€”</td><td id="cmpPtaD">â€”</td><td>0-15Â°</td></tr>
        <tr><td>KA(ë¬´ë¦ê°)</td><td id="cmpKaB">â€”</td><td id="cmpKaA">â€”</td><td id="cmpKaD">â€”</td><td>175-185Â°</td></tr>
        <tr><td>Tibial(ê²½ê³¨ê²½ì‚¬ê°)</td><td id="cmpTibialB">â€”</td><td id="cmpTibialA">â€”</td><td id="cmpTibialD">â€”</td><td>0-10Â°</td></tr>
        <tr><td>Q-Angle(Qê°)</td><td id="cmpQangleB">â€”</td><td id="cmpQangleA">â€”</td><td id="cmpQangleD">â€”</td><td>10-20Â°</td></tr>
        <tr><td>Knee Dev(ë¬´ë¦í¸ìœ„)</td><td id="cmpKneedevB">â€”</td><td id="cmpKneedevA">â€”</td><td id="cmpKneedevD">â€”</td><td>0-3Â°</td></tr>
        <tr><td>LLD(í•˜ì§€ê¸¸ì´ì°¨)</td><td id="cmpLldB">â€”</td><td id="cmpLldA">â€”</td><td id="cmpLldD">â€”</td><td>â‰¤1cm</td></tr>
        <tr><td>GSB(ì¤‘ë ¥ì¤‘ì‹¬ì„ )</td><td id="cmpGsbB">â€”</td><td id="cmpGsbA">â€”</td><td id="cmpGsbD">â€”</td><td>â‰¤2cm</td></tr>
        <tr><td>HPA(ê³ ê´€ì ˆê°)</td><td id="cmpHpaB">â€”</td><td id="cmpHpaA">â€”</td><td id="cmpHpaD">â€”</td><td>0-10Â°</td></tr>
        <tr><td>PDS(ìì„¸ì ìˆ˜)</td><td id="cmpPdsB">â€”</td><td id="cmpPdsA">â€”</td><td id="cmpPdsD">â€”</td><td>0-10</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">STA(ì–´ê¹¨ê¸°ìš¸ê¸°ê°)</td><td id="cmpStaB">â€”</td><td id="cmpStaA">â€”</td><td id="cmpStaD">â€”</td><td>â‰¤3Â°</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">POA(ê³¨ë°˜ê¸°ìš¸ê¸°ê°)</td><td id="cmpPoaB">â€”</td><td id="cmpPoaA">â€”</td><td id="cmpPoaD">â€”</td><td>â‰¤3Â°</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">LLD(í•˜ì§€ê¸¸ì´ì°¨)</td><td id="cmpLldfB">â€”</td><td id="cmpLldfA">â€”</td><td id="cmpLldfD">â€”</td><td>â‰¤1cm</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">TD(ì²´ê°„í¸ìœ„)</td><td id="cmpTdB">â€”</td><td id="cmpTdA">â€”</td><td id="cmpTdD">â€”</td><td>0-3Â°</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">HTA(ë¨¸ë¦¬ê¸°ìš¸ê¸°ê°)</td><td id="cmpHtaB">â€”</td><td id="cmpHtaA">â€”</td><td id="cmpHtaD">â€”</td><td>â‰¤3Â°</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">SPP(ì–´ê¹¨ê³¨ë°˜í‰í–‰ë„)</td><td id="cmpSppB">â€”</td><td id="cmpSppA">â€”</td><td id="cmpSppD">â€”</td><td>0-3Â°</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">KAS(ë¬´ë¦ì •ë ¬ëŒ€ì¹­ì„±)</td><td id="cmpKasB">â€”</td><td id="cmpKasA">â€”</td><td id="cmpKasD">â€”</td><td>0-3Â°</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">LLAS(í•˜ì§€ì¶•ëŒ€ì¹­ì„±)</td><td id="cmpLlasB">â€”</td><td id="cmpLlasA">â€”</td><td id="cmpLlasD">â€”</td><td>0-3Â°</td></tr>
        <tr style="background:rgba(46,196,182,0.1);"><td style="color:#2ec4b6; font-weight:600;">FBA(ë°œì •ë ¬ê°)</td><td id="cmpFbaB">â€”</td><td id="cmpFbaA">â€”</td><td id="cmpFbaD">â€”</td><td>0-3Â°</td></tr>
        <tr style="background:#f0f0f0; font-weight:600;"><td>ì²´í˜• ì ìˆ˜</td><td id="cmpScoreB">â€”</td><td id="cmpScoreA">â€”</td><td id="cmpScoreD">â€”</td><td>0â€“100</td></tr>
      </tbody>
    </table>
  </div>
</aside>
<main class="panel canvasWrap" style="order: 2;">
  <canvas id="cv" width="1600" height="1000"></canvas>
</main>

<!-- âœ… ì „ì—­ ì¶©ëŒ ë°©ì–´ ë° ê°•ì œ ë“±ë¡ (ìµœìš°ì„  ì‹¤í–‰) -->
<script>
// ---- ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” ë³´í˜¸ (ì¤‘ë³µ ì„ ì–¸ ë°©ì§€) ----
if (typeof window.cur === 'undefined') {
  window.cur = "Before";
}
if (typeof window.sessions === 'undefined') {
  window.sessions = {};
}
if (typeof window.currentSessions === 'undefined') {
  window.currentSessions = null;
}

// ---- ì „ì—­ ì¶©ëŒ ë°©ì–´ ----
window.analyzePostureAI = window.analyzePostureAI || function(before, after) {
  if (window.modelManager && !window.modelManager.ready) {
    console.log('modelManager not ready â€” models may not be loaded yet');
  }
  console.log("âœ… analyzePostureAI ê°•ì œ ë°”ì¸ë”© ì‹¤í–‰ë¨", { before, after });
  // ì‹¤ì œ í•¨ìˆ˜ê°€ ë‚˜ì¤‘ì— ì •ì˜ë˜ë©´ ë®ì–´ì”Œì›Œì§
  return { results: [], findings: [], muscles: { tight: [], weak: [] } };
};

// ---- íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬ ë¨¼ì € ì •ì˜ ----
window.handleFileUpload = window.handleFileUpload || function handleFileUpload(e) {
  const f = e.target.files[0];
  if(!f) return;
  const targetSessionName = window.cur || "Before";
  const targetSession = window.sessions[targetSessionName];
  if(!targetSession) {
    console.warn("ì„¸ì…˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }
  
  // í˜„ì¬ ì„ íƒëœ ë²„íŠ¼(ì •ë©´/ì˜†ëª¨ìŠµ) í™•ì¸
  const btnSide = document.getElementById("btnOrientationSide");
  const btnFront = document.getElementById("btnOrientationFront");
  const currentButtonOrientation = btnFront?.classList.contains("active") ? "front" 
    : (btnSide?.classList.contains("active") ? "side" : null);
  
  const guessedOrientation = currentButtonOrientation || targetSession.poseData?.orientation || "side";
  if(!targetSession.poseData) {
    targetSession.poseData = { orientation: guessedOrientation, landmarks: null, orientationMode: currentButtonOrientation ? "manual" : "auto" };
  } else if(!targetSession.poseData.orientationMode) {
    targetSession.poseData.orientationMode = currentButtonOrientation ? "manual" : "auto";
  }
  let imgKey = guessedOrientation === "front" ? "imgFront" : "imgSide";
  
  console.log("íŒŒì¼ ì—…ë¡œë“œ - í˜„ì¬ ì„ íƒëœ orientation:", guessedOrientation);
  
  const img = new Image();
  img.onerror = (e) => {
    console.error("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:", e);
    alert("ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
  };
  
    img.onload = async () => {
    targetSession[imgKey] = img;
    if(window.resizeCanvasFor) window.resizeCanvasFor(img);
    if(window.draw) window.draw();
    if(window.computeMetricsOnly) window.computeMetricsOnly();
    
    // í¬ì¦ˆ ë¶„ì„ ì‹¤í–‰ (ì •ë©´/ì˜†ëª¨ìŠµ ìë™ ê°ì§€)
    if(window.liveAnalyzer && window.liveAnalyzer.analyzeCurrentSession) {
      setTimeout(async () => {
        try {
          await window.liveAnalyzer.analyzeCurrentSession();
        } catch (err) {
          console.error("âŒ í¬ì¦ˆ ë¶„ì„ ì‹¤íŒ¨:", err);
        }
      }, 500);
    }
  };
  
  img.src = URL.createObjectURL(f);
  e.target.value = '';
};

// ---- íŒŒì¼ ì—…ë¡œë“œ ê°•ì œ ë“±ë¡ ----
window.setupFileUploads = window.setupFileUploads || function() {
  console.log("ğŸ“Œ setupFileUploads ê°•ì œ í™œì„±í™”");
  
  const fileInputs = document.querySelectorAll("input[type=file]");
  fileInputs.forEach(input => {
    // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° í›„ ì¬ë“±ë¡
    const newInput = input.cloneNode(true);
    input.parentNode.replaceChild(newInput, input);
    
    newInput.addEventListener("change", (e) => {
      console.log("ğŸ“ íŒŒì¼ ì„ íƒë¨:", e.target.files);
      if (typeof window.handleFileUpload === 'function') {
        window.handleFileUpload(e);
      } else {
        console.error("âŒ handleFileUpload í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      }
    });
  });
};

// DOM ì¤€ë¹„ë˜ë©´ ì¦‰ì‹œ ì‹¤í–‰
if (document.readyState === 'loading') {
  document.addEventListener("DOMContentLoaded", () => {
    console.log("ğŸ”¥ DOM ì¤€ë¹„ë¨ â†’ íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ ì£¼ì…");
    if (window.setupFileUploads) {
      window.setupFileUploads();
    }
  });
} else {
  // ì´ë¯¸ ë¡œë“œ ì™„ë£Œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
  console.log("ğŸ”¥ DOM ì´ë¯¸ ì¤€ë¹„ë¨ â†’ íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ ì£¼ì…");
  if (window.setupFileUploads) {
    window.setupFileUploads();
  }
  }
</script>

<!-- âœ… modelManager: front/side ëª¨ë¸ ë¶„ë¦¬ ë¡œë“œ ë° UI ì ê¸ˆ/í•´ì œ -->
<script type="module">
  // modelManager: front/side ëª¨ë¸ì„ ë¶„ë¦¬ ë¡œë“œí•˜ê³  UI ì ê¸ˆ/í•´ì œë¥¼ ë‹´ë‹¹
  function lockUI(reason = 'loading') {
    const aiBtn = document.getElementById('btnAIAnalysis');
    const overlayId = 'model-manager-overlay';
    let ov = document.getElementById(overlayId);
    if (!ov) {
      ov = document.createElement('div');
      ov.id = overlayId;
      ov.style.position = 'fixed';
      ov.style.top = '0';
      ov.style.left = '0';
      ov.style.width = '100%';
      ov.style.height = '100%';
      ov.style.background = 'rgba(0,0,0,0.25)';
      ov.style.display = 'flex';
      ov.style.alignItems = 'center';
      ov.style.justifyContent = 'center';
      ov.style.zIndex = '99999';
      ov.innerHTML = `<div style="padding:18px 20px; border-radius:12px; background:#0f1720; color:#fff; max-width:520px; font-family:var(--font-body); box-shadow:0 10px 30px rgba(0,0,0,0.6);">` +
        `<div style="font-weight:700; margin-bottom:8px;">ëª¨ë¸ ë¡œë”© ì¤‘â€¦</div>` +
        `<div id="modelManagerStatus" style="font-size:13px; color:#cbd5e1; line-height:1.4;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>` +
        `</div>`;
      document.body.appendChild(ov);
    }

    function unlockUI() {
      const aiBtn = document.getElementById('btnAIAnalysis');
      if (aiBtn) aiBtn.disabled = false;
      const ov = document.getElementById('model-manager-overlay');
      if (ov && ov.parentNode) ov.parentNode.removeChild(ov);
    }

    // ì•ˆì „í•œ ë™ì  importë¥¼ ìœ„í•œ í´ë°±(ë¸Œë¼ìš°ì €ê°€ importmapì„ ì§€ì›í•˜ì§€ ì•Šì„ ë•Œ)
    async function ensureMediapipePoseAvailable() {
      if (typeof window.MP_Pose !== 'undefined') return;
      try {
        // import mapì„ ì§€ì›í•˜ë©´ importmapì„ í†µí•´ ë§¤í•‘ëœ specifierê°€ í•´ê²°ë¨
        // ì—†ìœ¼ë©´ CDN ê²½ë¡œë¡œ ì§ì ‘ ë™ì  import
        const url = 'https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.164/pose.js';
        const mod = await import(url);
        // Some builds export default or named exports; provide a safe global
        window.MP_Pose = (mod && (mod.default || mod.Pose || mod)) || {};
        console.log('âœ… @mediapipe/pose loaded via CDN fallback');
      } catch (err) {
        console.warn('âš ï¸ @mediapipe/pose ë¡œë“œ ì‹¤íŒ¨ (CDN ì‹œë„):', err);
      }
    }

    // ëª¨ë¸ ë¡œë” ë˜í¼: TF ë¨¼ì € ë¡œë“œí•˜ê³ , mediapipe specifier ë¬¸ì œë¥¼ ìš°íšŒ
    async function loadPoseModelsSafe() {
      try {
        // 1) TF ë¶ˆëŸ¬ì˜¤ê¸° (ê¸°ì¡´ì˜ loadTfOnce ì‚¬ìš©)
        if (typeof window.loadTfOnce === 'function') {
          await window.loadTfOnce();
        } else if (typeof window.tf === 'undefined') {
          console.warn('âš ï¸ TensorFlow.js ë¡œë”ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }

        // 2) mediapipe fallback í™•ë³´
        await ensureMediapipePoseAvailable();

        // 3) í”„ë¡œì íŠ¸ì˜ ê¸°ì¡´ loadPoseModelsê°€ ìˆìœ¼ë©´ í˜¸ì¶œ
        if (typeof window.loadPoseModels === 'function') {
          await window.loadPoseModels();
        } else if (typeof window.loadModels === 'function') {
          await window.loadModels();
        } else {
          console.warn('âš ï¸ loadPoseModels / loadModels í•¨ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }

        // 4) í•´ì œ
        unlockUI();
        const statusEl = document.getElementById('modelManagerStatus');
        if (statusEl) statusEl.textContent = 'ëª¨ë¸ ë¡œë”© ì™„ë£Œ.';
      } catch (err) {
        console.error('ëª¨ë¸ ë¡œë”© ì¤‘ ì˜¤ë¥˜:', err);
        const statusEl = document.getElementById('modelManagerStatus');
        if (statusEl) statusEl.textContent = 'ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨: ' + (err && err.message ? err.message : String(err));
        // UI ì ê¸ˆ í•´ì œëŠ” ìƒí™©ì— ë”°ë¼ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ í•˜ì§€ ì•ŠìŒ â€” ê°œë°œìê°€ ìƒíƒœ í™•ì¸ í›„ ìˆ˜ë™ìœ¼ë¡œ í•´ì œ
      }
    }

    // ì¦‰ì‹œ ëª¨ë¸ ë¡œë“œ ì‹œë„
    lockUI();
    // ë¹„ë™ê¸° ë¡œë“œ ì‹œì‘ (ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…)
    setTimeout(() => {
      loadPoseModelsSafe().catch(err => console.error('loadPoseModelsSafe error', err));
    }, 0);
</script>

</body>
</html>